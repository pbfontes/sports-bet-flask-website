{% extends 'base.html' %}
{% block title %}
Trevo | Usuário
{% endblock %}

{% block content %}



<h4 class='ms-3 ps-3 pt-2'>Perfil: {{current_user.nome}}</h4>


<div class="row p-3 text-center">
    <div class="col-md-4 mb-3">
        <div class="card">
            <div class="card-body">
                Saldo: <span class="text-success" id="valor-saldo">R$ {{current_user.saldo}}</span>
            </div>
        </div>
    </div>
    <a class="col-md-4 text-decoration-none link-dark mb-3" href="{{url_for('alterar_dados')}}">
        <div class="card">
            <div class="card-body">
                Dados da conta
            </div>
        </div>
    </a>

    <a class="col-md-4 text-decoration-none link-dark mb-3" href="">
        <div class="card">
            <div class="card-body">
                Histórico de apostas
            </div>
        </div>
    </a>

    <a class="col-md-4 text-decoration-none link-dark" href="{{url_for('creator_page')}}">
        <div class="card">
            <div class="card-body">
                Gerenciar eventos
            </div>
        </div>
    </a>

</div>

<div id="open-bets" class="p-3"></div>

<!-- <div class="card mb-3 rounded-3">
    <div class="card-header">
        Featured
    </div>
    <div class="card-body">
        <div class="container">
            <div class="row g-3">
                <div class="col-lg-7 col-xxl-8">
                    <h5 class="card-title">Special title treatment</h5>
                    <p class="card-text">With supporting text below as a natural lead-in to additional content.</p>
                </div>
                <div class="col-lg-5 col-xxl-4">
                    <div class="d-grid gap-2 d-lg-flex justify-content-lg-end">
                        <button class="btn btn-secondary p-3 rounded-3" type="button">Time 1
                            <br class="d-none d-lg-block">
                            <span class="d-inline d-lg-none"> &nbsp; | &nbsp; </span>
                            <strong>9.4</strong>

                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div> -->

<script>
    // Create an XMLHttpRequest object
    const xhttp = new XMLHttpRequest();

    // Define a callback function
    xhttp.onload = function () {
        // Here you can use the Data
        var eventos = JSON.parse(this.responseText)
        eventos = eventos.events

        var content = `<h4 class='ms-3 mb-4 mt-2'>Apostas em aberto (${eventos.length})</h4>`

        for (let event of eventos) {
            if (event.status == "ativo") {
                content += `<div class="card mb-3 rounded-3">
                                <div class="card-header">
                                    ${event.categoria}
                                </div>
                                <div class="card-body">
                                    <div class="container">
                                        <div class="row g-3">
                                            <div class="col-lg-7 col-xxl-8">
                                                <h4 class="card-title">${event.titulo}</h4>
                                                <p class="card-text">${event.descricao}</p>
                                            </div>
                                            <div class="col-lg-5 col-xxl-4">
                                                <div class="d-grid gap-2 d-lg-flex justify-content-lg-end">`
                var options = Object.keys(event.opcoes)
                var nOptions = options.length
                for (let i = 0; i < nOptions; i++) {
                    content += `<a class="btn btn-secondary p-3 rounded-3" href="/visualizar_evento/${event._id.$oid}">${options[i]}
                                    <br class="d-none d-lg-block">
                                    <span class="d-inline d-lg-none"> &nbsp; | &nbsp; </span>
                                    <strong>${event.opcoes[options[i]].odd}</strong>
                                </a>`
                }

                content += ` </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>`
            }
        }

        console.log(this.responseText);
        document.getElementById("open-bets").innerHTML = content
    }

    // Send a request
    xhttp.open("GET", "/showEvents?usage=profile&status=active");
    xhttp.send();
</script>
{% endblock %}